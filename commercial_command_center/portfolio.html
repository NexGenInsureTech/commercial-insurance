<!doctype html>
<html>
  <head>
    <title>Portfolio</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="js/accessControl.js"></script>
    <script>
      restrict(["platformOwner", "strategy", "executive"]);
    </script>
    <script>
      console.log(
        "Portfolio data:",
        JSON.parse(localStorage.getItem("portfolioData")),
      );
    </script>
  </head>

  <body class="p-8 bg-slate-100">
    <h2 class="font-semibold mb-4">Portfolio</h2>

    <table class="bg-white w-full border">
      <thead>
        <tr class="border-b">
          <th class="p-2">Sector</th>
          <th class="p-2">Cluster</th>
          <th class="p-2">Loss Ratio</th>
        </tr>
      </thead>
      <tbody id="rows"></tbody>
    </table>

    <script src="js/dataStore.js"></script>
    <script>
      const data = getPortfolioData();
      const tbody = document.getElementById("rows");

      data.forEach((r) => {
        // ✅ DEBUG LOG — THIS IS THE RIGHT PLACE
        console.log(
          "Raw GWP:",
          r.GWP,
          "| toNumber:",
          toNumber(r.GWP),
          "| LossRatio:",
          calculateLossRatio(r).toFixed(2),
          "| Type:",
          typeof r.GWP,
        );
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td class="p-2">${r.Sector}</td>
          <td class="p-2">${r.Cluster}</td>
          <td class="p-2">${calculateLossRatio(r).toFixed(1)}%</td>
        `;
        tbody.appendChild(tr);
      });
    </script>
  </body>
</html>
